const chatBox = document.getElementById("chatBox");
const input = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");
const voiceBtn = document.getElementById("voiceBtn");
const focusToggle = document.getElementById("focusToggle");

let focusMode = false;

// Lightweight "encryption" simulation
function encrypt(text) {
  return btoa(text);
}

function decrypt(text) {
  return atob(text);
}

function addMessage(text, type) {
  const div = document.createElement("div");
  div.className = `message ${type}`;
  div.textContent = decrypt(text);
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Send text
sendBtn.onclick = () => {
  if (!input.value.trim()) return;
  const encrypted = encrypt(input.value);
  localStorage.setItem(Date.now(), encrypted);
  addMessage(encrypted, "sent");
  input.value = "";
};

// Voice note (low bitrate)
voiceBtn.onclick = async () => {
  if (!navigator.mediaDevices) {
    alert("Voice not supported");
    return;
  }
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  const recorder = new MediaRecorder(stream, { mimeType: "audio/webm" });

  recorder.start();
  setTimeout(() => recorder.stop(), 3000);

  recorder.ondataavailable = e => {
    if (!focusMode) {
      const audio = document.createElement("audio");
      audio.controls = true;
      audio.src = URL.createObjectURL(e.data);
      chatBox.appendChild(audio);
    }
  };
};

// Focus Mode
focusToggle.onclick = () => {
  focusMode = !focusMode;
  focusToggle.textContent = focusMode ? "Focus ON" : "Focus Mode";
};

